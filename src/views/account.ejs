<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Cuenta - GedotsHouse</title>

    <link rel="stylesheet" href="/css/store.css">
</head>
<body>

<!-- NAVBAR PICA -->
<nav class="epic-navbar" id="mainNav">
    <div class="nav-mega-container">

        <a href="/" class="epic-logo">
            <div class="logo-symbol"></div>
            <div class="logo-text">
                <h1>GedotsHouse</h1>
                <span class="logo-tagline">Premium Smart Home</span>
            </div>
        </a>

        <div></div>

        <div class="nav-actions-epic">
            <a href="/" class="btn-epic-primary"> Tienda</a>
            <button onclick="logout()" class="btn-epic-primary">Cerrar Sesi贸n</button>
        </div>
    </div>
</nav>

<section class="epic-cart-page" style="padding-top:4rem;">
    <div class="cart-mega-container" style="grid-template-columns: 320px 1fr;">

        <!-- =============================
             MEN LATERAL (Cuenta)
        ============================== -->
        <aside class="cart-summary-epic" style="position:relative;">
            <h2 class="summary-title-epic" style="font-size:1.6rem;">Mi Cuenta</h2>

            <div class="summary-rows">
                <button class="btn-checkout-epic" onclick="showSection('info')">
                    Informaci贸n Personal
                </button>

                <button class="btn-checkout-epic" onclick="showSection('edit')">
                    Editar Informaci贸n
                </button>

                <button class="btn-checkout-epic" onclick="showSection('password')">
                    Cambiar Contrase帽a
                </button>

                <button class="btn-checkout-epic" onclick="showSection('address')">
                    Direcci贸n de Env铆o
                </button>

                <button class="btn-checkout-epic" onclick="showSection('orders')">
                    Mis rdenes
                </button>
            </div>

            <button class="btn-epic-primary" onclick="logout()">
                Cerrar Sesi贸n
            </button>
        </aside>

        <!-- =============================
             CONTENIDO PRINCIPAL
        ============================== -->
        <div class="cart-items-section-epic" style="padding:3rem;">

            <!-- =============================
                 Info del Usuario
            ============================== -->
            <div id="section-info" class="account-section">
                <h1 class="cart-title-epic">Informaci贸n Personal</h1>

                <p><strong>Nombre:</strong> <%= user.name || "Sin nombre" %></p>
                <p><strong>Email:</strong> <%= user.email %></p>
                <p><strong>Rol:</strong> <%= user.role %></p>

                <hr class="mt-8">

                <button class="btn-hero-primary mt-8" onclick="showSection('edit')">Editar Informaci贸n</button>
            </div>

            <!-- =============================
                 Editar Informaci贸n
            ============================== -->
            <div id="section-edit" class="account-section hidden">
                <h1 class="cart-title-epic">Editar Informaci贸n</h1>

                <form action="/account/update" method="POST" class="form-epic">

                    <label>Nombre:</label>
                    <input type="text" name="name" class="search-input-epic"
                        value="<%= user.name || '' %>" required>

                    <label>Email:</label>
                    <input type="email" name="email" class="search-input-epic"
                        value="<%= user.email %>" required>

                    <button class="btn-hero-primary mt-8">Guardar Cambios</button>
                </form>
            </div>

            <!-- =============================
                 Cambiar contrase帽a
            ============================== -->
            <div id="section-password" class="account-section hidden">
                <h1 class="cart-title-epic">Cambiar Contrase帽a</h1>

                <form action="/account/change-password" method="POST" class="form-epic">

                    <label>Contrase帽a Actual:</label>
                    <input type="password" name="currentPassword" class="search-input-epic" required>

                    <label>Nueva Contrase帽a:</label>
                    <input type="password" name="newPassword" class="search-input-epic" required>

                    <label>Confirmar Nueva Contrase帽a:</label>
                    <input type="password" name="confirmPassword" class="search-input-epic" required>

                    <button class="btn-hero-primary mt-8">Cambiar Contrase帽a</button>
                </form>
            </div>

            <!-- =============================
                 Direcci贸n
            ============================== -->
            <div id="section-address" class="account-section hidden">
                <h1 class="cart-title-epic">Direcci贸n de Env铆o</h1>

                <form action="/account/address" method="POST" class="form-epic">

                    <label>Calle y N煤mero:</label>
                    <input type="text" name="street" class="search-input-epic"
                        value="<%= user.address_street || '' %>">

                    <label>Ciudad:</label>
                    <input type="text" name="city" class="search-input-epic"
                        value="<%= user.address_city || '' %>">

                    <label>Estado:</label>
                    <input type="text" name="state" class="search-input-epic"
                        value="<%= user.address_state || '' %>">

                    <label>C贸digo Postal:</label>
                    <input type="text" name="zip" class="search-input-epic"
                        value="<%= user.address_zip || '' %>">

                    <button class="btn-hero-primary mt-8">Guardar Direcci贸n</button>
                </form>
            </div>

            <!-- =============================
                 Historial de rdenes
            ============================== -->
            <div id="section-orders" class="account-section hidden">
                <h1 class="cart-title-epic">Mis rdenes</h1>

                <% if (!orders || orders.length === 0) { %>
                    <p class="text-secondary mt-8">No tienes 贸rdenes todav铆a.</p>

                <% } else { %>
                    <div class="products-grid-epic">
                        <% orders.forEach(order => { %>

                            <article class="product-card-epic">
                                <div class="product-info-epic">
                                    <h3 class="product-name-epic">
                                        Orden <%= order.order_number %>
                                    </h3>
                                    <p class="product-description-epic">
                                        Total: $<%= order.total_amount.toLocaleString("es-MX") %><br>
                                        Fecha: <%= order.created_at %>
                                    </p>
                                    <a href="/orders/<%= order.id %>" class="btn-hero-secondary">
                                        Ver Detalles
                                    </a>
                                </div>
                            </article>

                        <% }) %>
                    </div>
                <% } %>

            </div>

        </div>

    </div>
</section>

<script>
function showSection(id) {
    document.querySelectorAll(".account-section").forEach(sec => sec.classList.add("hidden"));
    document.getElementById("section-" + id).classList.remove("hidden");
}

async function logout() {
    await fetch("/auth/logout", { method: "POST" });
    window.location.href = "/login";
}
</script>

</body>
</html>